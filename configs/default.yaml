pipeline:
  version: "0.1.0"

paths:
  geomag:
    root: "地磁"
    sec_patterns:
      - "*.sec"
    min_patterns:
      - "*.min"
    read_mode: "sec"
  aef:
    root: "大气电磁信号/大气电场/kak202001-202010daef.min"
    min_patterns:
      - "*.min"
    read_mode: "min"
  seismic:
    root: "地震波"
    mseed_patterns:
      - "*.seed"
      - "*.mseed"
    sac_patterns:
      - "*.sac"
    stationxml: "地震波/stations_inventory.xml"
  vlf:
    root: "大气电磁信号/电磁波动vlf/vlf"
    patterns:
      - "*.cdf"

outputs:
  root: "outputs"

limits:
  max_files_per_source: null
  max_rows_per_source: null

events:
  - event_id: "eq_20200912_024411"
    name: "2020-09-12 Japan"
    origin_time_utc: "2020-09-12T02:44:11Z"
    lat: 38.748
    lon: 142.245
    depth_km: 34.0
    magnitude: 6.1

time:
  timezone: "UTC"
  align_interval: "1min"
  event_window:
    pre_hours: 72
    post_hours: 24
  align_strategy:
    geomag_sec: "aggregate"
    geomag_min: "no_interpolate"
    aef_min: "no_interpolate"
    seismic_waveform: "feature_then_align"

seismic:
  feature_interval_sec: 60

preprocess:
  batch_rows: 30000
  geomag:
    detrend:
      method: "linear"
    highpass:
      window_points: 600
      method: "rolling_median"
    wavelet:
      name: "db4"
      mode: "soft"
      threshold_scale: 1.0
    outlier:
      threshold: 6.0
    interpolate:
      max_gap_points: 10
      method: "linear"
    lowpass:
      window_points: 5
  aef:
    detrend:
      method: "linear"
    highpass:
      window_points: 300
      method: "rolling_median"
    wavelet:
      name: "db4"
      mode: "soft"
      threshold_scale: 1.0
    despike:
      window_points: 5
      zscore_mad_threshold: 6.0
    outlier:
      threshold: 6.0
    interpolate:
      max_gap_points: 5
      method: "linear"
    lowpass:
      window_points: 5
    expand_minute_to_seconds:
      seconds: 60
      mode: "centered"
      chunk_rows: 2000
  seismic_bandpass:
    freqmin_hz: 0.5
    freqmax_user_hz: 20.0
    freqmax_nyquist_ratio: 0.45
    taper_max_percentage: 0.05
    corners: 4
    zerophase: true
    notch:
      base_hz: [50, 60]
      half_width_hz: 0.5
      harmonics: 0
  vlf_preprocess:
    freq_line_mask:
      base_hz: [50, 60]
      harmonics: 5
      half_width_hz: 0.5
    time_median_window: 3
    standardize:
      bands_hz: [10, 1000, 3000, 10000]
      freq_agg: "median"
      time_agg: "median"
      target_interval: "1min"
    background_subtract:
      method: "median"

link:
  spatial_km: 1000
  require_station_location: false

features:
  rolling_window_minutes: 30
  topn_anomalies: 50
  association:
    change_threshold: 3.0
    min_sources: 2
    corr_threshold: 0.6
    max_lag_minutes: 30
    lag_step_minutes: 1
    min_overlap: 30
    min_points: 20
    topn_pairs: 50

vlf:
  band_edges_hz: [10, 1000, 3000, 10000]
  preview:
    max_time_bins: 200
    max_freq_bins: 200

storage:
  parquet:
    compression: "zstd"
    partition_cols: ["station_id", "date"]
    batch_rows: 30000
  zarr:
    compressor: "zstd"

api:
  host: "0.0.0.0"
  port: 8000
